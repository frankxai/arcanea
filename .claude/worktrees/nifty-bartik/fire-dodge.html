<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Fire Dodge - Arcanea Games</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
        },
      },
    }
  </script>
  <style>
    * {
      font-family: 'Inter', system-ui, sans-serif;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
    }
    .font-mono { font-family: 'JetBrains Mono', monospace; }

    /* Prevent pull-to-refresh on mobile */
    html, body {
      overscroll-behavior: none;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }

    /* Game canvas styling */
    #gameCanvas {
      display: block;
      touch-action: none;
    }

    /* Particle effect */
    .particle {
      position: absolute;
      pointer-events: none;
      border-radius: 50%;
      animation: particleFade 0.6s ease-out forwards;
    }
    @keyframes particleFade {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0); }
    }

    /* Screen shake */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .shake { animation: shake 0.15s ease-in-out; }

    /* Glow pulse */
    @keyframes glow-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(249,115,22,0.3); }
      50% { box-shadow: 0 0 40px rgba(249,115,22,0.5); }
    }
    .glow-pulse { animation: glow-pulse 2s ease-in-out infinite; }

    /* Score popup */
    .score-popup {
      animation: scoreFloat 0.8s ease-out forwards;
    }
    @keyframes scoreFloat {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-40px) scale(1.2); }
    }
  </style>
</head>
<body class="bg-slate-950 overflow-hidden">
  <!-- Game Container -->
  <div id="gameContainer" class="relative w-full h-full">
    <!-- Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- HUD Overlay -->
    <div id="hud" class="absolute top-0 left-0 right-0 p-4 flex justify-between items-start pointer-events-none">
      <!-- Score -->
      <div class="bg-slate-900/80 backdrop-blur-sm rounded-xl px-4 py-2 border border-slate-700/50">
        <p class="text-xs text-slate-500 uppercase tracking-wider">Score</p>
        <p id="scoreDisplay" class="text-2xl font-bold text-white font-mono">0</p>
      </div>

      <!-- Time Survived -->
      <div class="bg-slate-900/80 backdrop-blur-sm rounded-xl px-4 py-2 border border-slate-700/50">
        <p class="text-xs text-slate-500 uppercase tracking-wider">Time</p>
        <p id="timeDisplay" class="text-2xl font-bold text-orange-400 font-mono">0:00</p>
      </div>

      <!-- Combo -->
      <div id="comboContainer" class="bg-slate-900/80 backdrop-blur-sm rounded-xl px-4 py-2 border border-orange-500/30 opacity-0 transition-opacity">
        <p class="text-xs text-orange-400 uppercase tracking-wider">Combo</p>
        <p id="comboDisplay" class="text-2xl font-bold text-orange-400 font-mono">x1</p>
      </div>
    </div>

    <!-- Lives -->
    <div id="livesContainer" class="absolute bottom-4 left-4 flex gap-2">
      <div class="life-heart w-8 h-8 flex items-center justify-center">
        <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="life-heart w-8 h-8 flex items-center justify-center">
        <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="life-heart w-8 h-8 flex items-center justify-center">
        <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
        </svg>
      </div>
    </div>

    <!-- Pause Button -->
    <button id="pauseBtn" class="absolute bottom-4 right-4 w-12 h-12 bg-slate-900/80 backdrop-blur-sm rounded-xl border border-slate-700/50 flex items-center justify-center hover:bg-slate-800/80 transition-colors">
      <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
    </button>

    <!-- Start Screen -->
    <div id="startScreen" class="absolute inset-0 bg-slate-950/95 backdrop-blur-sm flex flex-col items-center justify-center p-8">
      <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center mb-6 glow-pulse">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
        </svg>
      </div>
      <h1 class="text-3xl font-bold text-white mb-2">Fire Dodge</h1>
      <p class="text-slate-400 text-center mb-8 max-w-xs">Dodge the falling meteors. Survive as long as you can.</p>

      <div class="space-y-4 w-full max-w-xs">
        <button id="startBtn" class="w-full py-4 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-400 hover:to-red-500 text-white font-semibold rounded-xl transition-all transform hover:scale-105">
          Start Game
        </button>
        <button onclick="window.location.href='games-portal.html'" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl border border-slate-700 transition-colors">
          Back to Portal
        </button>
      </div>

      <div class="mt-8 text-center">
        <p class="text-xs text-slate-600 uppercase tracking-wider mb-2">Controls</p>
        <div class="flex gap-4 text-slate-500 text-sm">
          <span>Arrow Keys / WASD</span>
          <span class="text-slate-700">|</span>
          <span>Touch & Drag</span>
        </div>
      </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="absolute inset-0 bg-slate-950/95 backdrop-blur-sm flex flex-col items-center justify-center p-8 hidden">
      <h1 class="text-4xl font-bold text-white mb-2">Game Over</h1>
      <p class="text-slate-400 mb-8">The flames consumed you.</p>

      <div class="bg-slate-900/80 rounded-2xl border border-slate-700/50 p-6 mb-8 w-full max-w-xs">
        <div class="grid grid-cols-2 gap-4 text-center">
          <div>
            <p class="text-xs text-slate-500 uppercase tracking-wider">Final Score</p>
            <p id="finalScore" class="text-3xl font-bold text-orange-400 font-mono">0</p>
          </div>
          <div>
            <p class="text-xs text-slate-500 uppercase tracking-wider">Time Survived</p>
            <p id="finalTime" class="text-3xl font-bold text-white font-mono">0:00</p>
          </div>
        </div>
        <div class="border-t border-slate-700/50 mt-4 pt-4">
          <p class="text-xs text-slate-500 uppercase tracking-wider text-center">Best Score</p>
          <p id="bestScore" class="text-2xl font-bold text-violet-400 font-mono text-center">0</p>
        </div>
      </div>

      <div class="space-y-3 w-full max-w-xs">
        <button id="restartBtn" class="w-full py-4 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-400 hover:to-red-500 text-white font-semibold rounded-xl transition-all">
          Play Again
        </button>
        <button onclick="window.location.href='games-portal.html'" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl border border-slate-700 transition-colors">
          Back to Portal
        </button>
      </div>
    </div>

    <!-- Pause Screen -->
    <div id="pauseScreen" class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm flex flex-col items-center justify-center p-8 hidden">
      <h1 class="text-3xl font-bold text-white mb-8">Paused</h1>
      <div class="space-y-3 w-full max-w-xs">
        <button id="resumeBtn" class="w-full py-4 bg-gradient-to-r from-orange-500 to-red-600 text-white font-semibold rounded-xl">
          Resume
        </button>
        <button id="quitBtn" class="w-full py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium rounded-xl border border-slate-700">
          Quit to Portal
        </button>
      </div>
    </div>
  </div>

  <script>
    // Game State
    const game = {
      canvas: null,
      ctx: null,
      width: 0,
      height: 0,
      running: false,
      paused: false,
      score: 0,
      time: 0,
      lives: 3,
      combo: 0,
      lastDodgeTime: 0,
      difficulty: 1,
      highScore: parseInt(localStorage.getItem('fire-dodge-highscore')) || 0,

      player: {
        x: 0,
        y: 0,
        width: 40,
        height: 40,
        speed: 8,
        targetX: 0,
        targetY: 0,
        trail: []
      },

      meteors: [],
      particles: [],
      powerups: [],

      keys: {
        left: false,
        right: false,
        up: false,
        down: false
      },

      touch: {
        active: false,
        x: 0,
        y: 0
      }
    };

    // Initialize
    function init() {
      game.canvas = document.getElementById('gameCanvas');
      game.ctx = game.canvas.getContext('2d');

      resize();
      window.addEventListener('resize', resize);

      // Keyboard
      document.addEventListener('keydown', handleKeyDown);
      document.addEventListener('keyup', handleKeyUp);

      // Touch
      game.canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
      game.canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
      game.canvas.addEventListener('touchend', handleTouchEnd);

      // Mouse (for desktop)
      game.canvas.addEventListener('mousedown', handleMouseDown);
      game.canvas.addEventListener('mousemove', handleMouseMove);
      game.canvas.addEventListener('mouseup', handleMouseUp);

      // Buttons
      document.getElementById('startBtn').addEventListener('click', startGame);
      document.getElementById('restartBtn').addEventListener('click', startGame);
      document.getElementById('pauseBtn').addEventListener('click', togglePause);
      document.getElementById('resumeBtn').addEventListener('click', togglePause);
      document.getElementById('quitBtn').addEventListener('click', () => window.location.href = 'games-portal.html');

      // Set best score display
      document.getElementById('bestScore').textContent = game.highScore.toLocaleString();
    }

    function resize() {
      game.width = window.innerWidth;
      game.height = window.innerHeight;
      game.canvas.width = game.width;
      game.canvas.height = game.height;

      // Update player size based on screen
      const baseSize = Math.min(game.width, game.height) * 0.06;
      game.player.width = Math.max(30, Math.min(50, baseSize));
      game.player.height = game.player.width;
    }

    function startGame() {
      // Reset state
      game.score = 0;
      game.time = 0;
      game.lives = 3;
      game.combo = 0;
      game.difficulty = 1;
      game.meteors = [];
      game.particles = [];
      game.powerups = [];

      // Center player
      game.player.x = game.width / 2;
      game.player.y = game.height - 120;
      game.player.targetX = game.player.x;
      game.player.targetY = game.player.y;
      game.player.trail = [];

      // Update UI
      updateLivesDisplay();
      updateScore(0);
      updateTime(0);
      updateCombo(0);

      // Hide screens
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('gameOverScreen').classList.add('hidden');
      document.getElementById('pauseScreen').classList.add('hidden');

      game.running = true;
      game.paused = false;

      requestAnimationFrame(gameLoop);
    }

    function gameLoop(timestamp) {
      if (!game.running) return;

      if (!game.paused) {
        update();
        render();
      }

      requestAnimationFrame(gameLoop);
    }

    function update() {
      // Update time
      game.time += 1/60;
      updateTime(game.time);

      // Increase difficulty over time
      game.difficulty = 1 + Math.floor(game.time / 15) * 0.3;

      // Update player position
      updatePlayer();

      // Spawn meteors
      if (Math.random() < 0.02 + (game.difficulty * 0.01)) {
        spawnMeteor();
      }

      // Spawn powerups occasionally
      if (Math.random() < 0.002) {
        spawnPowerup();
      }

      // Update meteors
      updateMeteors();

      // Update powerups
      updatePowerups();

      // Update particles
      updateParticles();

      // Check collisions
      checkCollisions();

      // Update score (survival bonus)
      if (Math.floor(game.time * 60) % 60 === 0) {
        addScore(10);
      }
    }

    function updatePlayer() {
      const p = game.player;

      // Keyboard movement
      if (game.keys.left) p.targetX -= p.speed;
      if (game.keys.right) p.targetX += p.speed;
      if (game.keys.up) p.targetY -= p.speed;
      if (game.keys.down) p.targetY += p.speed;

      // Touch/mouse movement
      if (game.touch.active) {
        p.targetX = game.touch.x;
        p.targetY = game.touch.y;
      }

      // Clamp to bounds
      p.targetX = Math.max(p.width/2, Math.min(game.width - p.width/2, p.targetX));
      p.targetY = Math.max(p.height/2, Math.min(game.height - p.height/2, p.targetY));

      // Smooth movement
      p.x += (p.targetX - p.x) * 0.15;
      p.y += (p.targetY - p.y) * 0.15;

      // Add trail
      if (game.time % 0.05 < 0.02) {
        p.trail.push({ x: p.x, y: p.y, alpha: 1 });
        if (p.trail.length > 10) p.trail.shift();
      }

      // Fade trail
      p.trail.forEach(t => t.alpha *= 0.9);
    }

    function spawnMeteor() {
      const size = 20 + Math.random() * 30 * game.difficulty;
      game.meteors.push({
        x: Math.random() * game.width,
        y: -size,
        size: size,
        speed: 3 + Math.random() * 4 * game.difficulty,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.2
      });
    }

    function spawnPowerup() {
      game.powerups.push({
        x: Math.random() * (game.width - 40) + 20,
        y: -30,
        type: Math.random() > 0.5 ? 'shield' : 'slow',
        speed: 2
      });
    }

    function updateMeteors() {
      for (let i = game.meteors.length - 1; i >= 0; i--) {
        const m = game.meteors[i];
        m.y += m.speed;
        m.rotation += m.rotationSpeed;

        // Remove if off screen
        if (m.y > game.height + m.size) {
          game.meteors.splice(i, 1);
          // Successful dodge - add combo
          game.combo++;
          game.lastDodgeTime = game.time;
          if (game.combo > 1) {
            addScore(game.combo * 5);
            updateCombo(game.combo);
          }
        }
      }

      // Reset combo if too long since last dodge
      if (game.time - game.lastDodgeTime > 2) {
        game.combo = 0;
        updateCombo(0);
      }
    }

    function updatePowerups() {
      for (let i = game.powerups.length - 1; i >= 0; i--) {
        const p = game.powerups[i];
        p.y += p.speed;

        if (p.y > game.height + 30) {
          game.powerups.splice(i, 1);
        }
      }
    }

    function updateParticles() {
      for (let i = game.particles.length - 1; i >= 0; i--) {
        const p = game.particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.02;

        if (p.life <= 0) {
          game.particles.splice(i, 1);
        }
      }
    }

    function checkCollisions() {
      const p = game.player;
      const playerRadius = p.width / 2 * 0.7; // Smaller hitbox for fairness

      // Check meteor collisions
      for (let i = game.meteors.length - 1; i >= 0; i--) {
        const m = game.meteors[i];
        const dist = Math.hypot(p.x - m.x, p.y - m.y);

        if (dist < playerRadius + m.size / 2) {
          // Hit!
          game.meteors.splice(i, 1);
          createExplosion(m.x, m.y, '#f97316');
          takeDamage();
          break;
        }
      }

      // Check powerup collisions
      for (let i = game.powerups.length - 1; i >= 0; i--) {
        const pu = game.powerups[i];
        const dist = Math.hypot(p.x - pu.x, p.y - pu.y);

        if (dist < playerRadius + 20) {
          game.powerups.splice(i, 1);
          createExplosion(pu.x, pu.y, '#22d3ee');
          addScore(100);
          // TODO: Apply powerup effect
        }
      }
    }

    function takeDamage() {
      game.lives--;
      game.combo = 0;
      updateCombo(0);
      updateLivesDisplay();

      // Screen shake
      document.getElementById('gameContainer').classList.add('shake');
      setTimeout(() => document.getElementById('gameContainer').classList.remove('shake'), 150);

      if (game.lives <= 0) {
        gameOver();
      }
    }

    function createExplosion(x, y, color) {
      for (let i = 0; i < 12; i++) {
        const angle = (Math.PI * 2 / 12) * i;
        game.particles.push({
          x: x,
          y: y,
          vx: Math.cos(angle) * (2 + Math.random() * 3),
          vy: Math.sin(angle) * (2 + Math.random() * 3),
          size: 4 + Math.random() * 4,
          color: color,
          life: 1
        });
      }
    }

    function addScore(points) {
      game.score += points;
      updateScore(game.score);
    }

    function gameOver() {
      game.running = false;

      // Save high score
      if (game.score > game.highScore) {
        game.highScore = game.score;
        localStorage.setItem('fire-dodge-highscore', game.highScore);
      }

      // Update game over screen
      document.getElementById('finalScore').textContent = game.score.toLocaleString();
      document.getElementById('finalTime').textContent = formatTime(game.time);
      document.getElementById('bestScore').textContent = game.highScore.toLocaleString();

      // Save to Arcanea player data
      savePlayerProgress();

      document.getElementById('gameOverScreen').classList.remove('hidden');
    }

    function togglePause() {
      game.paused = !game.paused;
      document.getElementById('pauseScreen').classList.toggle('hidden', !game.paused);
    }

    function render() {
      const ctx = game.ctx;

      // Clear
      ctx.fillStyle = '#020617';
      ctx.fillRect(0, 0, game.width, game.height);

      // Draw gradient background
      const gradient = ctx.createLinearGradient(0, 0, 0, game.height);
      gradient.addColorStop(0, 'rgba(249, 115, 22, 0.05)');
      gradient.addColorStop(1, 'rgba(220, 38, 38, 0.05)');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, game.width, game.height);

      // Draw particles
      game.particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
        ctx.fillStyle = p.color.replace(')', `, ${p.life})`).replace('rgb', 'rgba');
        ctx.fill();
      });

      // Draw player trail
      game.player.trail.forEach((t, i) => {
        ctx.beginPath();
        ctx.arc(t.x, t.y, game.player.width/2 * t.alpha * 0.5, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(249, 115, 22, ${t.alpha * 0.3})`;
        ctx.fill();
      });

      // Draw player
      const p = game.player;

      // Glow
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.width, 0, Math.PI * 2);
      const glowGradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.width);
      glowGradient.addColorStop(0, 'rgba(249, 115, 22, 0.3)');
      glowGradient.addColorStop(1, 'rgba(249, 115, 22, 0)');
      ctx.fillStyle = glowGradient;
      ctx.fill();

      // Core
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.width/2, 0, Math.PI * 2);
      const playerGradient = ctx.createRadialGradient(p.x - 5, p.y - 5, 0, p.x, p.y, p.width/2);
      playerGradient.addColorStop(0, '#fb923c');
      playerGradient.addColorStop(1, '#ea580c');
      ctx.fillStyle = playerGradient;
      ctx.fill();

      // Draw meteors
      game.meteors.forEach(m => {
        ctx.save();
        ctx.translate(m.x, m.y);
        ctx.rotate(m.rotation);

        // Glow
        ctx.beginPath();
        ctx.arc(0, 0, m.size * 0.8, 0, Math.PI * 2);
        const meteorGlow = ctx.createRadialGradient(0, 0, 0, 0, 0, m.size * 0.8);
        meteorGlow.addColorStop(0, 'rgba(239, 68, 68, 0.4)');
        meteorGlow.addColorStop(1, 'rgba(239, 68, 68, 0)');
        ctx.fillStyle = meteorGlow;
        ctx.fill();

        // Core
        ctx.beginPath();
        ctx.arc(0, 0, m.size / 2, 0, Math.PI * 2);
        const meteorGradient = ctx.createRadialGradient(-m.size/6, -m.size/6, 0, 0, 0, m.size/2);
        meteorGradient.addColorStop(0, '#fca5a5');
        meteorGradient.addColorStop(0.5, '#ef4444');
        meteorGradient.addColorStop(1, '#7f1d1d');
        ctx.fillStyle = meteorGradient;
        ctx.fill();

        ctx.restore();
      });

      // Draw powerups
      game.powerups.forEach(pu => {
        ctx.beginPath();
        ctx.arc(pu.x, pu.y, 15, 0, Math.PI * 2);
        ctx.fillStyle = pu.type === 'shield' ? '#22d3ee' : '#a78bfa';
        ctx.fill();

        ctx.beginPath();
        ctx.arc(pu.x, pu.y, 20, 0, Math.PI * 2);
        ctx.strokeStyle = pu.type === 'shield' ? 'rgba(34, 211, 238, 0.3)' : 'rgba(167, 139, 250, 0.3)';
        ctx.lineWidth = 2;
        ctx.stroke();
      });
    }

    // Input Handlers
    function handleKeyDown(e) {
      if (e.key === 'ArrowLeft' || e.key === 'a') game.keys.left = true;
      if (e.key === 'ArrowRight' || e.key === 'd') game.keys.right = true;
      if (e.key === 'ArrowUp' || e.key === 'w') game.keys.up = true;
      if (e.key === 'ArrowDown' || e.key === 's') game.keys.down = true;
      if (e.key === 'Escape') togglePause();
      if (e.key === ' ' && !game.running) startGame();
    }

    function handleKeyUp(e) {
      if (e.key === 'ArrowLeft' || e.key === 'a') game.keys.left = false;
      if (e.key === 'ArrowRight' || e.key === 'd') game.keys.right = false;
      if (e.key === 'ArrowUp' || e.key === 'w') game.keys.up = false;
      if (e.key === 'ArrowDown' || e.key === 's') game.keys.down = false;
    }

    function handleTouchStart(e) {
      e.preventDefault();
      const touch = e.touches[0];
      game.touch.active = true;
      game.touch.x = touch.clientX;
      game.touch.y = touch.clientY;
    }

    function handleTouchMove(e) {
      e.preventDefault();
      if (game.touch.active) {
        const touch = e.touches[0];
        game.touch.x = touch.clientX;
        game.touch.y = touch.clientY;
      }
    }

    function handleTouchEnd(e) {
      game.touch.active = false;
    }

    function handleMouseDown(e) {
      game.touch.active = true;
      game.touch.x = e.clientX;
      game.touch.y = e.clientY;
    }

    function handleMouseMove(e) {
      if (game.touch.active) {
        game.touch.x = e.clientX;
        game.touch.y = e.clientY;
      }
    }

    function handleMouseUp() {
      game.touch.active = false;
    }

    // UI Updates
    function updateScore(score) {
      document.getElementById('scoreDisplay').textContent = score.toLocaleString();
    }

    function updateTime(time) {
      document.getElementById('timeDisplay').textContent = formatTime(time);
    }

    function updateCombo(combo) {
      const container = document.getElementById('comboContainer');
      const display = document.getElementById('comboDisplay');

      if (combo > 1) {
        container.style.opacity = '1';
        display.textContent = `x${combo}`;
      } else {
        container.style.opacity = '0';
      }
    }

    function updateLivesDisplay() {
      const hearts = document.querySelectorAll('.life-heart svg');
      hearts.forEach((heart, i) => {
        heart.style.opacity = i < game.lives ? '1' : '0.2';
      });
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function savePlayerProgress() {
      const player = JSON.parse(localStorage.getItem('arcanea-player') || '{"xp":0,"level":1,"games":{}}');

      // Add XP based on performance
      const xpGained = Math.floor(game.score * 0.5 + game.time * 10);
      player.xp = (player.xp || 0) + xpGained;

      // Track game stats
      if (!player.games['fire-dodge']) {
        player.games['fire-dodge'] = { plays: 0, bestScore: 0, totalTime: 0 };
      }
      player.games['fire-dodge'].plays++;
      player.games['fire-dodge'].bestScore = Math.max(player.games['fire-dodge'].bestScore, game.score);
      player.games['fire-dodge'].totalTime += game.time;

      localStorage.setItem('arcanea-player', JSON.stringify(player));
    }

    // Start
    init();
  </script>
</body>
</html>
