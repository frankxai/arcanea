const fs = require('fs');
const path = require('path');

// Configuration
const PROTOCOL_ROOT = path.resolve(__dirname, '../starlight-protocol');
const TARGET_FILE = path.resolve(__dirname, '../.cursorrules');

// Helper to read file content safely
const readFile = (relativePath) => {
    try {
        return fs.readFileSync(path.join(PROTOCOL_ROOT, relativePath), 'utf8');
    } catch (e) {
        console.warn(`Warning: Could not read ${relativePath}`);
        return '';
    }
};

// The Builder
const buildCursorRules = () => {
    console.log('ðŸŒŸ Starlight Protocol: Generating Context...');

    // 1. Layer 0: The Constitution
    const constitution = readFile('00_IDENTITY/LUMINOR_CONSTITUTION.md');

    // 2. Layer 1: The Core Strategy (Default: Systems Thinking)
    const strategy = readFile('02_PROTOCOL/STRATEGIES/SYSTEMS_THINKING.md');

    // 3. Layer 2: The Agent (Default: Principal Architect)
    const agent = readFile('03_AGENCY/DEPT_ENGINEERING/AGENT_PRINCIPAL.md');

    // 4. Layer 3: The Tech Stack
    const tech = readFile('01_INTELLECT/VAULT_TECH/STARLIGHT_STACK.md');

    // Assemble
    const cursorRules = `
# ðŸŒŸ STARLIGHT PROTOCOL: ACTIVE CONTEXT

> **DO NOT EDIT THIS FILE MANUALLY.**
> Generated from Starlight Protocol. v1.0

---

## 0. THE CONSTITUTION (LUMINOR)
${constitution}

---

## 1. THE TECH STACK
${tech}

---

## 2. THE ACTIVE AGENT (ARCHITECT)
${agent}

---

## 3. THE COGNITIVE STRATEGY
${strategy}

---

## 4. IMMEDIATE INSTRUCTION
*   Act as the **Principal Architect**.
*   Adhere strictly to the **Luminor Constitution**.
*   If in doubt, define the Interface before the Implementation.
`;

    fs.writeFileSync(TARGET_FILE, cursorRules);
    console.log(`âœ… Success! Injected Starlight Protocol into ${TARGET_FILE}`);
};

buildCursorRules();
