/**
 * ARCANEA PWA STYLES
 * Version: 1.0.0
 * Description: Progressive Web App specific styles for Arcanea applications
 * Includes: Service worker notifications, install prompts, offline indicators
 */

/* ========================================
   TABLE OF CONTENTS
   ========================================
   1. PWA Root Styles
   2. Service Worker Notifications
   3. Install Prompt Styles
   4. Offline Indicator
   5. App-like Header/Footer
   6. No URL Bar Styling
   7. iOS Standalone Mode
   8. Splash Screen
   9. Theme Color Management
   ======================================== */

/* ========================================
   1. PWA ROOT STYLES
   ======================================== */

/* Standalone Mode - App-like Experience */
@media all and (display-mode: standalone) {
    body {
        /* Prevent rubber-band scrolling */
        overscroll-behavior-y: none;
        -webkit-overflow-scrolling: touch;
    }

    /* Remove default touch callout */
    * {
        -webkit-touch-callout: none;
    }

    /* Make everything feel more app-like */
    .arc-pwa-app-frame {
        height: 100vh;
        height: 100dvh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .arc-pwa-app-content {
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
    }
}

/* Fullscreen Mode */
@media all and (display-mode: fullscreen) {
    body {
        overscroll-behavior: none;
    }
}

/* ========================================
   2. SERVICE WORKER NOTIFICATIONS
   ======================================== */

/* Update Available Notification */
.arc-pwa-update-notification {
    position: fixed;
    top: calc(env(safe-area-inset-top) + var(--arc-space-md));
    left: var(--arc-space-md);
    right: var(--arc-space-md);
    background: var(--arc-bg-card);
    border: 1px solid var(--arc-border-default);
    border-radius: var(--arc-radius-lg);
    padding: var(--arc-space-md) var(--arc-space-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--arc-space-md);
    box-shadow: var(--arc-shadow-lg);
    z-index: var(--arc-z-toast);
    transform: translateY(-150%);
    transition: transform var(--arc-transition-normal);
}

.arc-pwa-update-notification.arc-show {
    transform: translateY(0);
}

.arc-pwa-update-icon {
    width: var(--arc-touch-sm);
    height: var(--arc-touch-sm);
    background: linear-gradient(135deg, var(--arc-gold), #ff8f00);
    border-radius: var(--arc-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.arc-pwa-update-content {
    flex: 1;
}

.arc-pwa-update-title {
    font-family: 'Cinzel', serif;
    font-size: var(--arc-text-base);
    font-weight: 600;
    margin: 0;
}

.arc-pwa-update-message {
    font-size: var(--arc-text-sm);
    color: var(--arc-text-muted);
    margin-top: var(--arc-space-xs);
}

.arc-pwa-update-actions {
    display: flex;
    gap: var(--arc-space-sm);
}

.arc-pwa-update-btn {
    padding: var(--arc-space-sm) var(--arc-space-md);
    font-size: var(--arc-text-sm);
    min-height: 40px;
}

/* Service Worker Status Badge */
.arc-pwa-sw-status {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom) + var(--arc-space-md));
    right: var(--arc-space-md);
    display: flex;
    align-items: center;
    gap: var(--arc-space-sm);
    padding: var(--arc-space-xs) var(--arc-space-sm);
    background: var(--arc-bg-card);
    border: 1px solid var(--arc-border-subtle);
    border-radius: var(--arc-radius-full);
    font-size: var(--arc-text-xs);
    color: var(--arc-text-muted);
    z-index: var(--arc-z-tooltip);
    opacity: 0;
    transition: opacity var(--arc-transition-normal);
}

.arc-pwa-sw-status.arc-visible {
    opacity: 1;
}

.arc-pwa-sw-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--arc-success);
    animation: arc-pwa-pulse 2s ease-in-out infinite;
}

.arc-pwa-sw-status-dot.arc-offline {
    background: var(--arc-error);
}

.arc-pwa-sw-status-dot.arc-syncing {
    background: var(--arc-warning);
}

@keyframes arc-pwa-pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

/* Sync In Progress Indicator */
.arc-pwa-sync-indicator {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--arc-bg-elevated);
    z-index: 10000;
    overflow: hidden;
}

.arc-pwa-sync-indicator::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 50%;
    background: linear-gradient(90deg, var(--arc-gold), var(--arc-fire));
    animation: arc-pwa-sync-slide 1.5s ease-in-out infinite;
}

@keyframes arc-pwa-sync-slide {
    0% { transform: translateX(-100%); }
    50% { transform: translateX(200%); }
    100% { transform: translateX(-100%); }
}

/* ========================================
   3. INSTALL PROMPT STYLES
   ======================================== */

/* Before Install Prompt - Custom UI */
.arc-pwa-install-prompt {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom) + var(--arc-space-md));
    left: var(--arc-space-md);
    right: var(--arc-space-md);
    background: linear-gradient(135deg, var(--arc-bg-card), var(--arc-bg-elevated));
    border: 1px solid var(--arc-gold);
    border-radius: var(--arc-radius-xl);
    padding: var(--arc-space-lg);
    box-shadow: var(--arc-shadow-glow), var(--arc-shadow-xl);
    z-index: var(--arc-z-modal);
    transform: translateY(150%);
    transition: transform var(--arc-transition-slow);
}

.arc-pwa-install-prompt.arc-show {
    transform: translateY(0);
}

.arc-pwa-install-header {
    display: flex;
    align-items: center;
    gap: var(--arc-space-md);
    margin-bottom: var(--arc-space-md);
}

.arc-pwa-install-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, var(--arc-gold), #ff8f00);
    border-radius: var(--arc-radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
}

.arc-pwa-install-title {
    font-family: 'Cinzel', serif;
    font-size: var(--arc-h4-mobile);
    margin: 0;
}

.arc-pwa-install-subtitle {
    font-size: var(--arc-text-sm);
    color: var(--arc-text-muted);
}

.arc-pwa-install-benefits {
    display: flex;
    flex-wrap: wrap;
    gap: var(--arc-space-sm);
    margin: var(--arc-space-md) 0;
}

.arc-pwa-install-benefit {
    display: flex;
    align-items: center;
    gap: var(--arc-space-xs);
    font-size: var(--arc-text-sm);
    color: var(--arc-text-secondary);
    background: var(--arc-bg-elevated);
    padding: var(--arc-space-xs) var(--arc-space-sm);
    border-radius: var(--arc-radius-sm);
}

.arc-pwa-install-benefit::before {
    content: 'âœ“';
    color: var(--arc-success);
    font-weight: bold;
}

.arc-pwa-install-actions {
    display: flex;
    gap: var(--arc-space-md);
    margin-top: var(--arc-space-lg);
}

.arc-pwa-install-actions .arc-mobile-btn {
    flex: 1;
}

/* Mini Install Banner */
.arc-pwa-install-mini {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom));
    left: 0;
    right: 0;
    background: var(--arc-bg-card);
    border-top: 1px solid var(--arc-border-default);
    padding: var(--arc-space-md);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--arc-space-md);
    z-index: var(--arc-z-fixed);
    transform: translateY(100%);
    transition: transform var(--arc-transition-normal);
}

.arc-pwa-install-mini.arc-show {
    transform: translateY(0);
}

.arc-pwa-install-mini-content {
    display: flex;
    align-items: center;
    gap: var(--arc-space-sm);
    font-size: var(--arc-text-sm);
}

.arc-pwa-install-mini-icon {
    width: 32px;
    height: 32px;
    background: var(--arc-gold);
    border-radius: var(--arc-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
}

/* iOS Install Instructions */
.arc-pwa-ios-instructions {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(5px);
    z-index: var(--arc-z-modal);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--arc-space-lg);
    opacity: 0;
    visibility: hidden;
    transition: all var(--arc-transition-normal);
}

.arc-pwa-ios-instructions.arc-show {
    opacity: 1;
    visibility: visible;
}

.arc-pwa-ios-card {
    background: var(--arc-bg-card);
    border-radius: var(--arc-radius-xl);
    padding: var(--arc-space-xl);
    max-width: 360px;
    text-align: center;
}

.arc-pwa-ios-arrow {
    font-size: 3rem;
    color: var(--arc-gold);
    animation: arc-pwa-bounce 1s ease-in-out infinite;
    margin-bottom: var(--arc-space-md);
}

@keyframes arc-pwa-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.arc-pwa-ios-steps {
    text-align: left;
    margin: var(--arc-space-lg) 0;
}

.arc-pwa-ios-step {
    display: flex;
    align-items: flex-start;
    gap: var(--arc-space-md);
    margin-bottom: var(--arc-space-md);
    font-size: var(--arc-text-base);
}

.arc-pwa-ios-step-number {
    width: 28px;
    height: 28px;
    background: var(--arc-gold);
    color: #000;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: var(--arc-text-sm);
    flex-shrink: 0;
}

/* ========================================
   4. OFFLINE INDICATOR
   ======================================== */

/* Offline Banner */
.arc-pwa-offline-banner {
    position: fixed;
    top: env(safe-area-inset-top);
    left: 0;
    right: 0;
    background: linear-gradient(90deg, var(--arc-error), #d32f2f);
    color: white;
    padding: var(--arc-space-sm) var(--arc-space-md);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--arc-space-sm);
    font-size: var(--arc-text-sm);
    font-weight: 500;
    z-index: var(--arc-z-fixed);
    transform: translateY(-100%);
    transition: transform var(--arc-transition-normal);
}

.arc-pwa-offline-banner.arc-show {
    transform: translateY(0);
}

.arc-pwa-offline-banner::before {
    content: 'ðŸ“¡';
    font-size: 1rem;
}

/* Offline Mode Badge */
.arc-pwa-offline-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--arc-space-xs);
    padding: var(--arc-space-xs) var(--arc-space-sm);
    background: rgba(244, 67, 54, 0.2);
    border: 1px solid var(--arc-error);
    border-radius: var(--arc-radius-sm);
    font-size: var(--arc-text-xs);
    color: var(--arc-error);
    font-weight: 500;
}

.arc-pwa-offline-badge::before {
    content: '';
    width: 6px;
    height: 6px;
    background: var(--arc-error);
    border-radius: 50%;
    animation: arc-pwa-offline-pulse 2s ease-in-out infinite;
}

@keyframes arc-pwa-offline-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* Cache Status Indicator */
.arc-pwa-cache-status {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom) + var(--arc-space-md));
    left: 50%;
    transform: translateX(-50%) translateY(200%);
    background: var(--arc-bg-card);
    border: 1px solid var(--arc-border-default);
    border-radius: var(--arc-radius-full);
    padding: var(--arc-space-sm) var(--arc-space-lg);
    display: flex;
    align-items: center;
    gap: var(--arc-space-sm);
    font-size: var(--arc-text-sm);
    color: var(--arc-text-muted);
    box-shadow: var(--arc-shadow-lg);
    z-index: var(--arc-z-tooltip);
    transition: transform var(--arc-transition-normal);
}

.arc-pwa-cache-status.arc-show {
    transform: translateX(-50%) translateY(0);
}

.arc-pwa-cache-icon {
    animation: arc-pwa-spin 1s linear infinite;
}

@keyframes arc-pwa-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* ========================================
   5. APP-LIKE HEADER/FOOTER
   ======================================== */

/* PWA Header - Fixed and Styled */
.arc-pwa-header {
    position: fixed;
    top: env(safe-area-inset-top);
    left: 0;
    right: 0;
    height: 56px;
    background: rgba(10, 10, 15, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--arc-border-subtle);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 var(--arc-space-md);
    z-index: var(--arc-z-fixed);
}

.arc-pwa-header-title {
    font-family: 'Cinzel', serif;
    font-size: var(--arc-h5-mobile);
    font-weight: 600;
    flex: 1;
    text-align: center;
    margin: 0 var(--arc-space-md);
}

.arc-pwa-header-btn {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    color: var(--arc-text-primary);
    font-size: 1.25rem;
    border-radius: var(--arc-radius-full);
    cursor: pointer;
}

.arc-pwa-header-btn:active {
    background: var(--arc-bg-elevated);
}

/* PWA Footer Navigation */
.arc-pwa-footer {
    position: fixed;
    bottom: env(safe-area-inset-bottom);
    left: 0;
    right: 0;
    height: calc(56px + env(safe-area-inset-bottom));
    background: rgba(10, 10, 15, 0.98);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid var(--arc-border-subtle);
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding-top: var(--arc-space-sm);
    z-index: var(--arc-z-fixed);
}

.arc-pwa-footer-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    min-width: 64px;
    padding: var(--arc-space-xs);
    color: var(--arc-text-muted);
    text-decoration: none;
    font-size: 0.625rem;
    font-weight: 500;
    transition: color var(--arc-transition-fast);
}

.arc-pwa-footer-item.arc-active {
    color: var(--arc-gold);
}

.arc-pwa-footer-item:active {
    color: var(--arc-text-primary);
}

.arc-pwa-footer-icon {
    font-size: 1.5rem;
    line-height: 1;
}

/* Content Area with Header/Footer Offset */
.arc-pwa-content {
    padding-top: calc(56px + env(safe-area-inset-top));
    padding-bottom: calc(56px + env(safe-area-inset-bottom));
    min-height: 100vh;
    min-height: 100dvh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* ========================================
   6. NO URL BAR STYLING
   ======================================== */

/* Hide URL Bar on Scroll (iOS Safari) */
.arc-pwa-full-height {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: 100dvh;
}

/* Prevent URL bar from reappearing */
.arc-pwa-scroll-container {
    height: 100vh;
    height: 100dvh;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
}

/* Standalone Mode Adjustments */
@media all and (display-mode: standalone) {
    /* Remove browser chrome compensation */
    .arc-pwa-header {
        top: 0;
    }

    .arc-pwa-content {
        padding-top: 56px;
    }

    /* Add device-specific safe areas */
    .arc-pwa-safe-top {
        padding-top: env(safe-area-inset-top);
    }

    .arc-pwa-safe-bottom {
        padding-bottom: env(safe-area-inset-bottom);
    }
}

/* ========================================
   7. iOS STANDALONE MODE SUPPORT
   ======================================== */

/* iOS Standalone Mode Detection */
@media all and (display-mode: standalone) {
    .arc-ios-standalone .arc-pwa-header {
        padding-top: env(safe-area-inset-top);
        height: calc(56px + env(safe-area-inset-top));
    }

    .arc-ios-standalone .arc-pwa-content {
        padding-top: calc(56px + env(safe-area-inset-top));
    }

    .arc-ios-standalone .arc-pwa-footer {
        height: calc(56px + env(safe-area-inset-bottom));
        padding-bottom: env(safe-area-inset-bottom);
    }

    .arc-ios-standalone .arc-pwa-content {
        padding-bottom: calc(56px + env(safe-area-inset-bottom));
    }
}

/* iOS Notch Support */
@supports (padding-top: env(safe-area-inset-top)) {
    .arc-pwa-notch-spacer {
        height: env(safe-area-inset-top);
        background: var(--arc-bg-primary);
    }

    .arc-pwa-home-indicator-spacer {
        height: env(safe-area-inset-bottom);
        background: var(--arc-bg-primary);
    }
}

/* iOS Touch Action Fixes */
.arc-pwa-ios-touch-fix {
    touch-action: manipulation;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

/* ========================================
   8. SPLASH SCREEN
   ======================================== */

/* PWA Splash Screen */
.arc-pwa-splash {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--arc-bg-primary);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    transition: opacity var(--arc-transition-slow), visibility var(--arc-transition-slow);
}

.arc-pwa-splash.arc-hide {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

.arc-pwa-splash-logo {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, var(--arc-gold), #ff8f00);
    border-radius: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4rem;
    margin-bottom: var(--arc-space-xl);
    animation: arc-pwa-splash-pulse 2s ease-in-out infinite;
    box-shadow: 0 0 60px var(--arc-gold-glow);
}

@keyframes arc-pwa-splash-pulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 60px var(--arc-gold-glow); }
    50% { transform: scale(1.05); box-shadow: 0 0 80px var(--arc-gold-glow); }
}

.arc-pwa-splash-title {
    font-family: 'Cinzel', serif;
    font-size: var(--arc-h2-mobile);
    background: linear-gradient(135deg, var(--arc-gold), #ff8f00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: var(--arc-space-md);
}

.arc-pwa-splash-subtitle {
    font-size: var(--arc-text-base);
    color: var(--arc-text-muted);
}

.arc-pwa-splash-loader {
    margin-top: var(--arc-space-xl);
    width: 120px;
    height: 3px;
    background: var(--arc-bg-elevated);
    border-radius: 3px;
    overflow: hidden;
}

.arc-pwa-splash-loader-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--arc-gold), var(--arc-fire));
    border-radius: 3px;
    transition: width 0.3s ease;
    animation: arc-pwa-loading 2s ease-in-out infinite;
}

@keyframes arc-pwa-loading {
    0% { width: 0%; margin-left: 0%; }
    50% { width: 30%; margin-left: 35%; }
    100% { width: 0%; margin-left: 100%; }
}

/* ========================================
   9. THEME COLOR MANAGEMENT
   ======================================== */

/* Dynamic Theme Color Classes */
.arc-theme-fire { --arc-accent: var(--arc-fire); }
.arc-theme-water { --arc-accent: var(--arc-water); }
.arc-theme-earth { --arc-accent: var(--arc-earth); }
.arc-theme-wind { --arc-accent: var(--arc-wind); }
.arc-theme-void { --arc-accent: var(--arc-void); }
.arc-theme-gold { --arc-accent: var(--arc-gold); }

/* Status Bar Color Helpers */
.arc-pwa-status-bar-light {
    background: #ffffff;
}

.arc-pwa-status-bar-dark {
    background: #0a0a0f;
}

/* Theme Color Animation */
.arc-pwa-theme-transition {
    transition: background-color var(--arc-transition-slow);
}

/* ========================================
   PWA UTILITY CLASSES
   ======================================== */

/* Hide when installed */
.arc-pwa-hide-installed {
    display: block;
}

@media all and (display-mode: standalone) {
    .arc-pwa-hide-installed {
        display: none !important;
    }
}

/* Show only when installed */
.arc-pwa-show-installed {
    display: none;
}

@media all and (display-mode: standalone) {
    .arc-pwa-show-installed {
        display: block !important;
    }
}

/* Network Status Classes */
.arc-online-only {
    display: block;
}

body.arc-offline .arc-online-only {
    display: none !important;
}

.arc-offline-only {
    display: none;
}

body.arc-offline .arc-offline-only {
    display: block !important;
}

/* Install Status */
.arc-pwa-installed .arc-pwa-install-prompt,
.arc-pwa-installed .arc-pwa-install-mini {
    display: none !important;
}

/* ========================================
   ANIMATION KEYFRAMES
   ======================================== */

@keyframes arc-pwa-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes arc-pwa-slide-up {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes arc-pwa-shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

.arc-pwa-animate-shake {
    animation: arc-pwa-shake 0.5s ease-in-out;
}

/* ========================================
   PRINT STYLES
   ======================================== */

@media print {
    .arc-pwa-header,
    .arc-pwa-footer,
    .arc-pwa-install-prompt,
    .arc-pwa-install-mini,
    .arc-pwa-update-notification,
    .arc-pwa-offline-banner,
    .arc-pwa-sw-status {
        display: none !important;
    }

    .arc-pwa-content {
        padding: 0 !important;
    }
}

/* ========================================
   END OF ARCANEA PWA STYLES
   ======================================== */
