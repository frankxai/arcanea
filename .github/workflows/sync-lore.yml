name: Sync Canonical Lore

on:
  push:
    branches: [main]
    paths:
      - '.claude/lore/**'
      - 'packages/core/src/constants/mythology.ts'
  workflow_dispatch:

jobs:
  validate-canon:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate Canonical Consistency
        run: |
          echo "ðŸ”® Validating Arcanea Canon..."

          # Check that all 10 Guardians exist
          GUARDIANS=(lyssandria leyla draconia maylinn alera lyria aiyami elara ino shinkami)
          for guardian in "${GUARDIANS[@]}"; do
            if ! grep -q "$guardian" packages/core/src/constants/mythology.ts; then
              echo "âŒ Missing guardian: $guardian"
              exit 1
            fi
          done
          echo "âœ… All 10 Guardians present"

          # Check frequencies
          FREQS=(396 417 528 639 741 852 963 1111)
          for freq in "${FREQS[@]}"; do
            if ! grep -q "$freq" packages/core/src/constants/mythology.ts; then
              echo "âš ï¸ Missing frequency: $freq Hz"
            fi
          done
          echo "âœ… Solfeggio frequencies validated"

          echo "ðŸŒŸ Canon validation complete!"

  sync-lore:
    needs: validate-canon
    runs-on: ubuntu-latest
    steps:
      - name: Checkout arcanea
        uses: actions/checkout@v4

      - name: Sync lore to intelligence-os
        uses: actions/checkout@v4
        with:
          repository: frankxai/arcanea-intelligence-os
          path: sync/aios
          token: ${{ secrets.SYNC_TOKEN }}
        continue-on-error: true

      - name: Update canonical references
        run: |
          # Sync lore files
          if [ -d ".claude/lore" ] && [ -d "sync/aios" ]; then
            mkdir -p sync/aios/lore
            cp -r .claude/lore/* sync/aios/lore/ 2>/dev/null || true

            cd sync/aios
            git config user.name "Arcanea Lore Keeper"
            git config user.email "lore@arcanea.ai"
            git add -A
            git diff --staged --quiet || git commit -m "lore: sync canonical updates from arcanea"
            git push || true
          fi
        continue-on-error: true

      - name: Lore Sync Complete
        run: |
          echo "ðŸ“œ Canonical lore synchronized across the Arcanea universe"
